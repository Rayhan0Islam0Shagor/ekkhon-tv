import Head from "next/head";
import Link from "next/link";
import { motion } from "framer-motion";
// import Image from "next/image";
// import { useState } from "react";

export default function Home({ data }) {
  // const [loading, setLoading] = useState(true);

  return (
    <>
      <Head>
        <title>Server Side | Ekhon TV :: এখন টিভি</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="https://ekhon.tv/media/common/favicon2.png" />
        <meta
          name="keywords"
          content="এখন টিভি,অনলাইন পত্রিকা, পত্রিকা, বাংলাদেশ পত্রিকা, আজকের পত্রিকা, দেশে এখন, বাজার, কাচা বাজার, মুদ্রা বাজার, শেয়ার বাজার, আন্তর্জাতিক বাজার, ক্রিপ্টো, বিদেশে এখন, ক্রিকেট, ফুটবল, এখন মাঠে, এখন আনন্দ, সিনেমা, নাটক, তথ্য প্রযুক্তি, নাগরিক সাংবাদিকতা, পাঠকের কথা, চলতি হাওয়া, পরিবেশ, আবহাওয়া, উদ্যোক্তা"
        />
      </Head>

      <div className="flex items-center justify-center w-full py-5">
        <Link
          href="/csr"
          className="px-4 py-2 transition-all duration-500 border border-indigo-400 hover:bg-indigo-400"
        >
          Check client side rendering
        </Link>
      </div>

      <main className="max-w-screen-xl p-5 mx-auto ">
        <div className="grid grid-cols-1 gap-5 lg:grid-cols-3 xl:grid-cols-4 sm:grid-cols-2">
          {data?.map(
            (
              {
                CategoryID,
                CategoryName,
                ContentBrief,
                ContentHeading,
                ImageBgPath,
                ImageSmPath,
                ImageThumbPath,
                ShowVideo,
                Slug,
                URLAlies,
                VideoID,
                created_at,
                VideoType,
                ContentID,
              },
              index
            ) => (
              <motion.div
                initial={{ opacity: 0, y: 25 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ delay: index * 0.3, duration: 0.5 }}
                key={index}
                className="relative flex items-end justify-start w-full text-left bg-right-top bg-no-repeat bg-cover h-96 dark:bg-gray-500"
                style={{
                  backgroundImage: `url(https://backoffice.ekhon.tv/media/imgAll/${ImageBgPath})`,
                }}
              >
                <div className="absolute top-0 bottom-0 left-0 right-0 bg-gradient-to-b via-transparent from-gray-900 to-gray-900" />
                <div className="absolute top-0 left-0 right-0 flex items-center justify-between mx-5 mt-3">
                  <span className="px-3 py-2 text-xs font-semibold tracking-wider uppercase  text-gray-900 bg-[#FCB415]">
                    {CategoryName}
                  </span>
                  <div className="flex flex-col justify-start text-center dark:text-gray-100">
                    <span className="text-3xl font-semibold leading-none tracking-wide">
                      {
                        new Date(created_at)
                          .toLocaleDateString("bn-BD", {
                            month: "long",
                            day: "numeric",
                          })
                          .split(" ")[0]
                      }
                    </span>
                    <span className="leading-none uppercase">
                      {
                        new Date(created_at)
                          .toLocaleDateString("bn-BD", {
                            month: "long",
                            day: "numeric",
                          })
                          .split(" ")[1]
                      }
                    </span>
                  </div>
                </div>
                <div className="z-10">
                  <h2 className="px-3 pb-2">
                    <Link
                      href={`/${Slug}/news/${ContentID}`}
                      className="font-semibold  text-md hover:underline text-[#FCB415]"
                    >
                      {ContentHeading}
                    </Link>
                  </h2>
                  <p className="px-3 pb-1 text-sm font-medium text-gray-300">
                    {ContentBrief.substring(0, 100) + "..."}
                  </p>
                </div>
              </motion.div>
            )
          )}
        </div>
      </main>
    </>
  );
}

export async function getServerSideProps({ req, res }) {
  const response = await fetch(
    "https://backoffice.ekhon.tv/api/json/file/generateSpecial1.json"
  );
  const data = await response.json();

  res.setHeader(
    "Cache-Control",
    "public, s-maxage=10, stale-while-revalidate=59"
  );

  return {
    props: {
      data: data.data,
    },
  };
}
